// Last modified 09.07.2010 by Alex Zolotarev

Maps update specification

1. Necessary Settings

[x] Offline mode

2. Specific behaviour

- Display message about application update available in the app store and disable maps update without application update.
- Display log message about unsuccessful connection attempt somewhere (for easier debugging and to passionate users)
- Display estimated space for index before download
- Display error message about no free space available when downloading/indexing
- Do correct cleanup for all temporary files if error occurred during download or indexing
- Maps are downloaded and indexed one-by-one in background with progress indicator
- All marked for downloading maps displays "Waiting…"
- When next map is downloading previous can be indexed 
- After indexing is finished, map is automatically applied and displayed on the screen
- If map was updated, previous version should be deleted
- Download button should be available only for new version of maps
- Delete button should be available for all downloaded maps

3. Use cases

Case 1: 1st client startup on the device after installation.

- Base world file is included in the resources and should be loaded automatically at startup
- Connection established and up-to-date maps list is downloaded in background
- If download failed, nothing is displayed (optional log string in map manager is displayed)
- If download succeeded, received information is parsed and Maps Manager view is populated with data
- If user opens Map Manager, he sees all available maps, and can mark maps for downloading
- 1st map download will start automatically
- Other marked maps will wait until 1st map is downloaded
- Application should be completely usable during download

Case 2: Startup with some maps already downloaded

4. Meta information format details

Each .dat file contains meta information at the beginning. This information includes:
- Group of countries to which this map belongs
- Country name
- Region name
- Map version
- Size of the data part
All text information can be localised, by default English version is used.
Format is:
<offset>                <values>
0                       uint64_t sizeOfXmlDescription
8                       xml meta description
…
sizeOfXmlDescription+8  actual .dat file contents
…

This information is read during .update file generation on the server and at iPhone app startup.
.update file is downloaded by clients to check if new map version is available. Meta information in this file contains one additional parameter for each map, called Url, which defines url for clients to download .dat file.

[for Version 2]
- Add incremental patches support

